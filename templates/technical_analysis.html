<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Eavest - Trader Assistant</title>
        <link rel="icon" href="{{ url_for('static', filename='logo.png') }}" type="image/png">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
        <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css" rel="stylesheet">
        <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    </head>
<body class="min-h-screen p-4 animated-gradient">
    <div class="max-w-7xl mx-auto">
        <header class="mb-8 glass-card rounded-lg p-6">
            <div class="flex items-center justify-between mb-2">
                <div class="flex items-center">
                    <img src="{{ url_for('static', filename='logo.png') }}" alt="Eavest Logo" class="h-12 w-12 mr-3">
                    <h1 class="text-3xl font-bold">Eavest - Trader Assistant</h1>
                </div>
                <nav class="flex space-x-6">
                    <a href="/" class="text-primary-500 font-bold">
                        <i class="fas fa-chart-pie mr-2"></i><span class="hidden sm:inline">Portfolio</span>
                    </a>
                    <a href="/technical-analysis" class="text-gray-600 hover:text-primary-500">
                        <i class="fas fa-chart-line mr-2"></i><span class="hidden sm:inline">Technical Analysis</span>
                    </a>
                </nav>
            </div>
            <p class="text-gray-600">Upload, analyse, and project your investment portfolio</p>
            <div class="mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-md text-yellow-800 text-sm">
                <strong>Disclaimer:</strong> This tool is for educational and informational purposes only. It does not constitute investment advice. The projections and analyses generated by AI may not be accurate and should not be the sole basis for investment decisions. Always consult with a qualified financial advisor before making investment choices.
            </div>
        </header>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- Upload Section -->
      <div class="md:col-span-1">
        <div id="simpleModeSection" class="glass-card rounded-lg p-6 mb-6 card-hover">
          <h2 class="text-xl font-semibold mb-4">Chart Upload</h2>
          <div class="dropzone p-8 text-center cursor-pointer mb-4" id="simpleUploadArea">
            <div class="flex flex-col items-center justify-center">
              <i class="fas fa-chart-line text-4xl mb-4 text-gray-400"></i>
              <p class="mb-2 font-semibold" style="color: var(--text-color);">Drag & drop your chart image or click to browse</p>
              <p class="text-sm" style="color: var(--text-lighter);">Supports: JPG, PNG, WebP</p>
              <p class="text-sm mt-2" style="color: var(--text-lighter);">Or paste from clipboard (Ctrl+V / Cmd+V)</p>
            </div>
          </div>
          <input type="file" id="simpleFileInput" class="hidden" accept="image/*">
          <div class="text-center mt-2 mb-4">
            <button id="fallbackUploadBtn" class="text-sm py-1 px-3 rounded-full" style="background: rgba(94, 170, 216, 0.2); color: var(--info-color);">
              <i class="fas fa-upload mr-1"></i>Browse files
            </button>
          </div>
          <div id="simpleImagePreview" class="image-preview hidden mb-4">
            <div class="relative">
              <img src="" alt="Chart Preview" class="shadow-md">
              <button id="simpleRemoveBtn" class="absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>
          
          <button id="analyzeBtn" class="w-full p-2 btn-primary rounded mt-4" disabled>
            Analyse Chart
          </button>
        </div>
        
        <div id="advancedModeSection" class="glass-card rounded-lg p-6 mb-6 card-hover hidden">
          <h2 class="text-xl font-semibold mb-4">Multi-Timeframe Analysis</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div class="dropzone p-4 text-center cursor-pointer" data-index="0">
              <div class="flex flex-col items-center justify-center">
                <p class="font-semibold mb-1" style="color: var(--text-color);">Weekly Timeframe</p>
                <i class="fas fa-chart-line text-2xl mb-2 text-gray-400"></i>
                <p class="text-xs" style="color: var(--text-lighter);">Drag & drop or click</p>
                <input type="file" class="advanced-file-input hidden" accept="image/*" data-index="0">
              </div>
            </div>
            <div class="dropzone p-4 text-center cursor-pointer" data-index="1">
              <div class="flex flex-col items-center justify-center">
                <p class="font-semibold mb-1" style="color: var(--text-color);">Daily Timeframe</p>
                <i class="fas fa-chart-line text-2xl mb-2 text-gray-400"></i>
                <p class="text-xs" style="color: var(--text-lighter);">Drag & drop or click</p>
                <input type="file" class="advanced-file-input hidden" accept="image/*" data-index="1">
              </div>
            </div>
            <div class="dropzone p-4 text-center cursor-pointer" data-index="2">
              <div class="flex flex-col items-center justify-center">
                <p class="font-semibold mb-1" style="color: var(--text-color);">4H Timeframe</p>
                <i class="fas fa-chart-line text-2xl mb-2 text-gray-400"></i>
                <p class="text-xs" style="color: var(--text-lighter);">Drag & drop or click</p>
                <input type="file" class="advanced-file-input hidden" accept="image/*" data-index="2">
              </div>
            </div>
            <div class="dropzone p-4 text-center cursor-pointer" data-index="3">
              <div class="flex flex-col items-center justify-center">
                <p class="font-semibold mb-1" style="color: var(--text-color);">1H Timeframe</p>
                <i class="fas fa-chart-line text-2xl mb-2 text-gray-400"></i>
                <p class="text-xs" style="color: var(--text-lighter);">Drag & drop or click</p>
                <input type="file" class="advanced-file-input hidden" accept="image/*" data-index="3">
              </div>
            </div>
          </div>
          <div id="advancedImagePreviews" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <!-- Image previews will be added here dynamically -->
          </div>
          
          <button id="analyzeAdvancedBtn" class="w-full p-2 btn-primary rounded mt-4" disabled>
            Analyse Multi-Timeframe
          </button>
        </div>
        
        <div class="glass-card rounded-lg p-6 card-hover">
          <h2 class="text-xl font-semibold mb-4">Analysis Options</h2>
          <div class="space-y-4">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 sm:gap-0">
              <span class="font-medium mb-2 sm:mb-0">Analysis Mode</span>
              <div class="flex space-x-2 w-full sm:w-auto">
                <button id="simpleMode" class="btn-primary py-2 px-3 text-sm flex-1 sm:flex-none">Simple</button>
                <button id="advancedMode" class="btn-secondary py-2 px-3 text-sm flex-1 sm:flex-none">Advanced</button>
              </div>
            </div>
            
            <div class="border-t border-custom pt-4">
              <h3 class="font-medium mb-2">Visual Options</h3>
              <div class="flex items-center justify-between mb-2">
                <label class="text-sm">Show Support/Resistance</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="showSupport" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="flex items-center justify-between mb-2">
                <label class="text-sm">Show Trend Lines</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="showTrend" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="flex items-center justify-between">
                <label class="text-sm">Show Entry/Exit Points</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="showPoints" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Analysis and Results Panel -->
      <div class="md:col-span-2">
        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="hidden mb-6 text-center">
          <div class="glass-card p-6 flex flex-col items-center justify-center">
            <div class="loading-spinner mb-4"></div>
            <p class="text-lg" style="color: var(--text-color);">Analyzing your chart...</p>
            <p class="text-sm mt-2" style="color: var(--text-lighter);">This may take a minute</p>
          </div>
        </div>
        
        <!-- Results Section -->
        <div id="resultsSection" class="hidden">
          <div class="glass-card rounded-lg p-6 mb-6 card-hover">
            <div class="flex border-b border-custom mb-4">
              <div id="tab-summary" class="tab active p-2">
                <i class="fas fa-chart-pie mr-2"></i>
                <span>Summary</span>
              </div>
              <div id="tab-details" class="tab p-2">
                <i class="fas fa-list-ul mr-2"></i>
                <span>Details</span>
              </div>
              <div id="tab-drawn" class="tab p-2">
                <i class="fas fa-draw-polygon mr-2"></i>
                <span>Annotations</span>
              </div>
            </div>
            
            <!-- Summary Tab Content -->
            <div id="content-summary" class="tab-content">
              <!-- Market Sentiment -->
              <div class="analysis-card">
                <h3 class="text-lg font-semibold mb-4" style="color: var(--text-color);">Market Sentiment</h3>
                <div class="flex items-center justify-center gap-4">
                  <div id="bullishIndicator" class="hidden flex items-center gap-2 px-4 py-2 rounded-full" style="background: rgba(88, 216, 133, 0.2); color: var(--success-color); font-weight: bold;">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd" />
                    </svg>
                    Bullish
                  </div>
                  <div id="neutralIndicator" class="flex items-center gap-2 px-4 py-2 rounded-full" style="background: rgba(113, 128, 150, 0.2); color: var(--text-lighter); font-weight: bold;">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M18 10a1 1 0 01-1 1H3a1 1 0 110-2h14a1 1 0 011 1z" clip-rule="evenodd" />
                    </svg>
                    Neutral
                  </div>
                  <div id="bearishIndicator" class="hidden flex items-center gap-2 px-4 py-2 rounded-full" style="background: rgba(254, 178, 178, 0.2); color: var(--danger-color); font-weight: bold;">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M12 13a1 1 0 110 2H7a1 1 0 01-1-1V9a1 1 0 112 0v3.586l4.293-4.293a1 1 0 011.414 0L16 10.586V9a1 1 0 112 0v5a1 1 0 01-1 1h-5z" clip-rule="evenodd" />
                    </svg>
                    Bearish
                  </div>
                </div>
              </div>
              
              <!-- Volatility -->
              <div class="analysis-card">
                <h3 class="text-lg font-semibold mb-4" style="color: var(--text-color);">Volatility</h3>
                <div class="relative mx-auto max-w-md">
                  <div class="volatility-meter">
                    <div class="meter-background"></div>
                  </div>
                  <div id="volatilityIndicator" class="volatility-indicator" style="left: 50%;"></div>
                  <div class="flex justify-between text-xs mt-2" style="color: var(--text-lighter);">
                    <span>Low</span>
                    <span>Medium</span>
                    <span>High</span>
                  </div>
                </div>
              </div>
              
              <!-- Key Insights Summary -->
              <div class="analysis-card">
                <h3 class="text-lg font-semibold mb-4" style="color: var(--text-color);">Key Insights</h3>
                <div id="insightsContent" class="p-4 rounded-lg glass-card">
                  <div class="animate-pulse-slow h-4 bg-gray-200 dark:bg-gray-600 rounded w-3/4 mb-2"></div>
                  <div class="animate-pulse-slow h-4 bg-gray-200 dark:bg-gray-600 rounded w-full mb-2"></div>
                  <div class="animate-pulse-slow h-4 bg-gray-200 dark:bg-gray-600 rounded w-5/6 mb-2"></div>
                  <div class="animate-pulse-slow h-4 bg-gray-200 dark:bg-gray-600 rounded w-2/3"></div>
                </div>
              </div>
            </div>
            
            <!-- Details Tab Content -->
            <div id="content-details" class="tab-content hidden">
              <!-- Trading Opportunities -->
              <div class="analysis-card">
                <h3 class="text-lg font-semibold mb-4" style="color: var(--text-color);">Trading Opportunities</h3>
                <div id="opportunitiesContent" class="p-4 rounded-lg glass-card">
                  <div class="animate-pulse-slow h-4 bg-gray-200 dark:bg-gray-600 rounded w-3/4 mb-2"></div>
                  <div class="animate-pulse-slow h-4 bg-gray-200 dark:bg-gray-600 rounded w-full mb-2"></div>
                  <div class="animate-pulse-slow h-4 bg-gray-200 dark:bg-gray-600 rounded w-5/6"></div>
                </div>
              </div>
              
              <!-- Detailed Analysis -->
              <div class="analysis-card">
                <h3 class="text-lg font-semibold mb-4" style="color: var(--text-color);">Technical Analysis</h3>
                <div id="technicalContent" class="p-4 rounded-lg glass-card">
                  <div class="animate-pulse-slow h-4 bg-gray-200 dark:bg-gray-600 rounded w-full mb-2"></div>
                  <div class="animate-pulse-slow h-4 bg-gray-200 dark:bg-gray-600 rounded w-5/6 mb-2"></div>
                  <div class="animate-pulse-slow h-4 bg-gray-200 dark:bg-gray-600 rounded w-4/5 mb-2"></div>
                  <div class="animate-pulse-slow h-4 bg-gray-200 dark:bg-gray-600 rounded w-full"></div>
                </div>
              </div>
            </div>
            
            <!-- Drawn Chart Tab Content -->
            <div id="content-drawn" class="tab-content hidden">
              <div id="drawnChartSection">
                <div class="glass-card p-6 mb-4">
                  <h3 class="text-lg font-semibold mb-4" style="color: var(--text-color);">Chart with Support & Resistance</h3>
                  <div id="drawnChartContainer" class="image-preview">
                    <!-- Drawn chart will be inserted here -->
                  </div>
                  <div id="verificationMessage" class="mt-4 p-3 rounded-lg hidden" style="background: rgba(88, 216, 133, 0.2); color: var(--success-color);">
                    <p class="flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                      </svg>
                      Lines verified by AI for accuracy
                    </p>
                  </div>
                </div>
                <!-- <div class="flex flex-wrap gap-2 mb-4 items-center">
                  <span class="text-sm font-semibold" style="color: var(--text-color);">Toggle Elements:</span>
                  <button id="toggleSupport" class="px-3 py-1 rounded-full text-sm" style="background: rgba(94, 170, 216, 0.2); color: var(--info-color);">
                    <i class="fas fa-minus-square mr-1"></i>Support Lines
                  </button>
                  <button id="toggleResistance" class="px-3 py-1 rounded-full text-sm" style="background: rgba(254, 178, 178, 0.2); color: var(--danger-color);">
                    <i class="fas fa-minus-square mr-1"></i>Resistance Lines
                  </button>
                  <button id="toggleTrend" class="px-3 py-1 rounded-full text-sm" style="background: rgba(125, 125, 125, 0.2); color: var(--text-lighter);">
                    <i class="fas fa-arrow-trend-up mr-1"></i>Trend Lines
                  </button>
                  <button id="toggleEntries" class="px-3 py-1 rounded-full text-sm" style="background: rgba(88, 216, 133, 0.2); color: var(--success-color);">
                    <i class="fas fa-arrow-down-up-across-line mr-1"></i>Entry Points
                  </button>
                  <button id="toggleExits" class="px-3 py-1 rounded-full text-sm" style="background: rgba(254, 178, 178, 0.2); color: var(--danger-color);">
                    <i class="fas fa-right-from-bracket mr-1"></i>Exit Points
                  </button>
                  <button id="togglePatterns" class="px-3 py-1 rounded-full text-sm" style="background: rgba(251, 211, 141, 0.2); color: var(--warning-color);">
                    <i class="fas fa-chart-line mr-1"></i>Patterns
                  </button>
                </div> -->
              </div>
              
              <!-- Draw Lines Button -->
              <div class="flex justify-center mt-4">
                <button id="drawLinesBtn" class="btn-primary">
                  <i class="fas fa-pencil-alt mr-2"></i>Draw Support & Resistance Lines
                </button>
              </div>
            </div>
          </div>
                    
        </div>
        
        <!-- Initial Help Card -->
        <div id="helpCard" class="glass-card rounded-lg p-6 card-hover">
          <h2 class="text-xl font-semibold mb-4">Welcome to Chart Analysis Assistant</h2>
          <p class="mb-4">Upload a trading chart to analyse support/resistance levels, identify patterns, and get trading insights.</p>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="border border-custom rounded-lg p-4">
              <h3 class="font-semibold mb-2"><i class="fas fa-lightbulb text-yellow-500 mr-2"></i>Getting Started</h3>
              <ul class="list-disc pl-5 space-y-1 text-sm">
                <li>Upload your trading chart image</li>
                <li>Select simple or advanced analysis mode</li>
                <li>Click "Analyse Chart" to process</li>
                <li>Review the AI-generated insights</li>
              </ul>
            </div>
            
            <div class="border border-custom rounded-lg p-4">
              <h3 class="font-semibold mb-2"><i class="fas fa-star text-primary-500 mr-2"></i>Features</h3>
              <ul class="list-disc pl-5 space-y-1 text-sm">
                <li>Support & resistance detection</li>
                <li>Pattern recognition</li>
                <li>Market sentiment analysis</li>
                <li>Entry & exit point suggestions</li>
              </ul>
            </div>
          </div>
          
          <div class="border border-custom rounded-lg p-4 mt-4">
            <h3 class="font-semibold mb-2"><i class="fas fa-info-circle text-blue-500 mr-2"></i>Tips for Best Results</h3>
            <ul class="list-disc pl-5 space-y-1 text-sm">
              <li>Use clear, high-quality chart images</li>
              <li>Include price bars/candles and volume indicators when possible</li>
              <li>For multi-timeframe analysis, upload charts from different timeframes</li>
              <li>The more complete the chart history, the better the analysis</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <footer class="mt-8 py-4 text-center text-sm text-gray-600 glass-card rounded-lg p-3">
      &copy; <span id="currentYear"></span> Eavest by <a href="#" class="text-primary-500 hover:underline">Oscar So</a>. All rights reserved.
    </footer>
  </div>

    <script src="{{ url_for('static', filename='script_tech.js') }}"></script>
</body>
</html>
